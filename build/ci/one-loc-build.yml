# Name: DotNet-Project-System OneLocBuild
# Pipeline: https://dev.azure.com/dnceng/public/_build?definitionId=981
# LCL Source: https://dev.azure.com/ceapex/CEINTL/_git/LCL-JUNO-PROD-PRJSYS
#
# Creates the OneLocBuild PR for localization of the dotnet/project-system
#

resources:
- repo: self
  clean: true
pool:
  name: NetCorePublic-Pool
  queue: BuildPool.Windows.10.Amd64.VS2019.Pre.Open
  demands: Cmd
  timeoutInMinutes: 15
variables:
  DOTNET_SKIP_FIRST_TIME_EXPERIENCE: true

steps:
- task: PowerShell@2
  displayName: Create Language-Neutral .xlf Files
  inputs:
    targetType: 'inline'
    script: 'Get-ChildItem -Include *.es.xlf -File -Recurse | Copy-Item -Destination { $newPath = $_.FullName.Replace(''.es.xlf'', ''.xlf''); Write-Host "Creating $newPath"; $newPath }'
    workingDirectory: 'src'

- task: OneLocBuild@2
  displayName: Run Localization Process
  inputs:
    isCreatePrSelected: true
    isAutoCompletePrSelected: false
    repoType: gitHub
    gitHubPatVariable: '$(GitHubPat)'
    packageSourceAuth: patAuth
    patVariable: '$(OneLocBuildPat)'
    lclSource: lclFilesfromPackage
    lclPackageId: 'LCL-JUNO-PROD-PRJSYS'

- task: PublishBuildArtifacts@1
  displayName: Publish Localization Artifacts
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)\loc'
    ArtifactName: 'OneLocBuild'
    publishLocation: 'Container'
