<!-- Licensed to the .NET Foundation under one or more agreements. The .NET Foundation licenses this file to you under the MIT license. See the LICENSE.md file in the project root for more information. -->
<Project Sdk="Microsoft.NET.Sdk">

  <Import Project="..\..\build\import\VisualStudioDesigner.props" />

  <PropertyGroup>
    <RootNamespace>Microsoft.VisualStudio</RootNamespace>

    <!-- VSIX -->
    <ExtensionInstallationRoot>CommonExtensions</ExtensionInstallationRoot>
    <ExtensionInstallationFolder>Microsoft\VisualStudio\Editors</ExtensionInstallationFolder>
    <AddVsixForSigningDependsOn>CreateVsixContainer</AddVsixForSigningDependsOn>

    <!-- VS Setup -->
    <ManifestJsonName>Microsoft.VisualStudio.Editors</ManifestJsonName>

    <TargetVsixContainerName>$(AssemblyName).vsix</TargetVsixContainerName>
    <!-- Required to start in either OutDir or IntermediateOutputPath for signing. It'll be copied after signing via the CopyVsixAfterSigning target. -->
    <TargetVsixContainer>$(OutDir)$(TargetVsixContainerName)</TargetVsixContainer>
  </PropertyGroup>

  <ItemGroup>
    <ProjectReference Include="..\..\src\Microsoft.VisualStudio.AppDesigner\Microsoft.VisualStudio.AppDesigner.vbproj">
      <Name>Microsoft.VisualStudio.AppDesigner</Name>
      <IncludeOutputGroupsInVSIX>BuiltProjectOutputGroup;GetCopyToOutputDirectoryItems;SatelliteDllsProjectOutputGroup</IncludeOutputGroupsInVSIX>
      <IncludeOutputGroupsInVSIXLocalOnly>DebugSymbolsProjectOutputGroup</IncludeOutputGroupsInVSIXLocalOnly>
      <Ngen>true</Ngen>
      <NgenArchitecture>All</NgenArchitecture>
      <NgenPriority>3</NgenPriority>
      <ReferenceOutputAssembly>false</ReferenceOutputAssembly>
    </ProjectReference>
    <ProjectReference Include="..\..\src\Microsoft.VisualStudio.Editors\Microsoft.VisualStudio.Editors.vbproj">
      <Name>Microsoft.VisualStudio.Editors</Name>
      <IncludeOutputGroupsInVSIX>BuiltProjectOutputGroup;GetCopyToOutputDirectoryItems;SatelliteDllsProjectOutputGroup;PkgdefProjectOutputGroup</IncludeOutputGroupsInVSIX>
      <IncludeOutputGroupsInVSIXLocalOnly>DebugSymbolsProjectOutputGroup</IncludeOutputGroupsInVSIXLocalOnly>
      <Ngen>true</Ngen>
      <NgenArchitecture>All</NgenArchitecture>
      <NgenPriority>3</NgenPriority>
      <ReferenceOutputAssembly>false</ReferenceOutputAssembly>
    </ProjectReference>
  </ItemGroup>

  <ItemGroup>
    <Compile Include="..\Common\ProvideCodeBaseBindingRedirection.cs">
      <Link>ProvideCodeBaseBindingRedirection.cs</Link>
    </Compile>
  </ItemGroup>

  <!-- TODO: Create mechanism for local build version -->
  <!-- <Target Name="GetBuildVersion" Returns="$(BuildVersion)">
    <PropertyGroup>
      <BuildVersion>42.42.42.42</BuildVersion>
    </PropertyGroup>
  </Target> -->

  <ItemGroup>
    <FilesToSign Include="$(TargetVsixContainer)">
      <Authenticode>VsixSHA2</Authenticode>
    </FilesToSign>
  </ItemGroup>

  <Target Name="VSManifestBuild" AfterTargets="Build">
    <MSBuild Projects="$(MSBuildThisFileDirectory)Microsoft.VisualStudio.Editors.vsmanproj"
      Properties="SwixBuildDir=$(PkgMicrosoft_VisualStudioEng_MicroBuild_Plugins_SwixBuild)\build\;MicroBuildCoreDir=$(PkgMicrosoft_VisualStudioEng_MicroBuild_Core)\build\"
      Targets="Build" />
  </Target>

</Project>