<!-- Licensed to the .NET Foundation under one or more agreements. The .NET Foundation licenses this file to you under the MIT license. See the LICENSE.md file in the project root for more information. -->
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <MinimumVisualStudioVersion>17.0</MinimumVisualStudioVersion>
  </PropertyGroup>

  <Import Project="..\..\build\import\VisualStudioDesigner.props" />

  <PropertyGroup>
    <TargetFramework>net472</TargetFramework>
    <RootNamespace>Microsoft.VisualStudio</RootNamespace>
    <PublishOutputToSymStore>false</PublishOutputToSymStore>

    <!-- VSIX -->
    <IncludeAssemblyInVSIXContainer>false</IncludeAssemblyInVSIXContainer>
    <ExtensionInstallationRoot>CommonExtensions</ExtensionInstallationRoot>
    <ExtensionInstallationFolder>Microsoft\VisualStudio\Editors</ExtensionInstallationFolder>
    <AddVsixForSigningDependsOn>CreateVsixContainer</AddVsixForSigningDependsOn>

    <!-- VS Setup -->
    <ManifestJsonName>Microsoft.VisualStudio.Editors</ManifestJsonName>
  </PropertyGroup>

  <PropertyGroup>
    <SchemaVersion>2.0</SchemaVersion>
    <CreateVsixContainer>true</CreateVsixContainer>
    <!-- <GeneratePkgDefFile>false</GeneratePkgDefFile> -->

    <IncludeDebugSymbolsInVSIXContainer>false</IncludeDebugSymbolsInVSIXContainer>
    <IncludeDebugSymbolsInLocalVSIXDeployment>false</IncludeDebugSymbolsInLocalVSIXDeployment>
    <!-- <CopyBuildOutputToOutputDirectory>false</CopyBuildOutputToOutputDirectory> -->
    <!-- <CopyOutputSymbolsToOutputDirectory>false</CopyOutputSymbolsToOutputDirectory> -->
    <IncludeCopyLocalReferencesInVSIXContainer>false</IncludeCopyLocalReferencesInVSIXContainer>
    <IsProductComponent>true</IsProductComponent>
    <IsPackable>false</IsPackable>
    <UseCodebase>true</UseCodebase>

    <!-- https://gist.github.com/jstangroome/3087991 -->
    <!-- <SkipCopyBuildProduct>true</SkipCopyBuildProduct>
    <DebugSymbols>false</DebugSymbols>
    <DebugType>none</DebugType> -->
  </PropertyGroup>

  <PropertyGroup>
    <VsixSourceManifestPath>$(MSBuildProjectDirectory)\source.extension.vsixmanifest</VsixSourceManifestPath>
    <IsVsixProject>false</IsVsixProject>
    <IsVsixProject Condition="Exists('$(VsixSourceManifestPath)')">true</IsVsixProject>
  </PropertyGroup>

  <PropertyGroup Condition="'$(IsVsixProject)' == 'true'">
    <BuildForLiveUnitTesting>false</BuildForLiveUnitTesting>

    <StartAction>Program</StartAction>
    <StartProgram>$(DevEnvDir)devenv.exe</StartProgram>
    <StartArguments>/rootsuffix $(VSSDKTargetPlatformRegRootSuffix) /log</StartArguments>

    <Ngen>true</Ngen>
    <NgenArchitecture>All</NgenArchitecture>
    <NgenPriority>3</NgenPriority>

    <_TargetVsixContainerDir>$(VisualStudioSetupInsertionPath)</_TargetVsixContainerDir>

    <TargetVsixContainerName Condition="'$(TargetVsixContainerName)' == ''">$(MSBuildProjectName).vsix</TargetVsixContainerName>
    <TargetVsixContainer Condition="'$(TargetVsixContainer)' == ''">$(_TargetVsixContainerDir)$(TargetVsixContainerName)</TargetVsixContainer>

    <DeployExtension>false</DeployExtension>
    <DeployExtension Condition="'$(DeployProjectOutput)' == 'true'">true</DeployExtension>
  </PropertyGroup>

  <ItemGroup>
    <ProjectReference Include="..\..\src\Microsoft.VisualStudio.AppDesigner\Microsoft.VisualStudio.AppDesigner.vbproj">
      <Name>Microsoft.VisualStudio.AppDesigner</Name>
      <IncludeOutputGroupsInVSIX>BuiltProjectOutputGroup;GetCopyToOutputDirectoryItems;SatelliteDllsProjectOutputGroup</IncludeOutputGroupsInVSIX>
      <IncludeOutputGroupsInVSIXLocalOnly>DebugSymbolsProjectOutputGroup</IncludeOutputGroupsInVSIXLocalOnly>
      <Ngen>true</Ngen>
      <NgenArchitecture>All</NgenArchitecture>
      <NgenPriority>3</NgenPriority>
      <ReferenceOutputAssembly>false</ReferenceOutputAssembly>
    </ProjectReference>
    <ProjectReference Include="..\..\src\Microsoft.VisualStudio.Editors\Microsoft.VisualStudio.Editors.vbproj">
      <Name>Microsoft.VisualStudio.Editors</Name>
      <IncludeOutputGroupsInVSIX>BuiltProjectOutputGroup;GetCopyToOutputDirectoryItems;SatelliteDllsProjectOutputGroup;PkgdefProjectOutputGroup</IncludeOutputGroupsInVSIX>
      <IncludeOutputGroupsInVSIXLocalOnly>DebugSymbolsProjectOutputGroup</IncludeOutputGroupsInVSIXLocalOnly>
      <Ngen>true</Ngen>
      <NgenArchitecture>All</NgenArchitecture>
      <NgenPriority>3</NgenPriority>
      <ReferenceOutputAssembly>false</ReferenceOutputAssembly>
    </ProjectReference>
  </ItemGroup>

  <ItemGroup>
    <Compile Include="..\Common\ProvideCodeBaseBindingRedirection.cs">
      <Link>ProvideCodeBaseBindingRedirection.cs</Link>
    </Compile>
  </ItemGroup>

  <!-- TODO: Create mechanism for local build version -->
  <!-- <Target Name="GetBuildVersion" Returns="$(BuildVersion)">
    <PropertyGroup>
      <BuildVersion>42.42.42.42</BuildVersion>
    </PropertyGroup>
  </Target> -->

  <Target Name="VSManifestBuild" AfterTargets="Build">
    <MSBuild Projects="$(MSBuildThisFileDirectory)Microsoft.VisualStudio.Editors.vsmanproj"
      Properties="SwixBuildDir=$(PkgMicrosoft_VisualStudioEng_MicroBuild_Plugins_SwixBuild)\build\"
      Targets="Build" />
  </Target>

</Project>